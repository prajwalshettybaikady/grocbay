{% extends '@AppBundle/Admin/base.html.twig' %}
{% block styles %}
<!--nestable CSS -->
<link href="/assets/plugins/nestable/nestable.css" rel="stylesheet" type="text/css" />
 <script src="https://apis.google.com/js/platform.js" async defer></script>
       <script type="text/javascript"
            src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyBSR3pigsWMH7goi_CthGQFckfb5QPOH8E&v=3.21.5a&libraries=drawing&signed_in=true&libraries=places,drawing,geometry"></script>
<style>
</style>

{% endblock %}
{% block body %}
 <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Create Pickup Location</h4>
        </div>
        <div class="modal-body">
          <form method="post" action="{{ path('create_pickup_location') }}">

<div class="form-group">
  <label>Pickup Location Name</label>
  <input type="text" class="form-control" placeholder="Pickup Location Name" name="name">
</div>
<div class="form-group">
  <label>Address</label>
  <textarea class="form-control" rows="3" placeholder="Address" name="address"></textarea>
</div>
<div class="form-group">
  <label>Contact Number</label>
  <input type="text" class="form-control" placeholder="Contact Number" name="contact">
</div>
<div class="form-group">
  <label>Delivery Block</label>
  <select class="form-control" name="area">
 {% for area in areas %}
 <option value="{{ area.id }}">{{ area.title }}</option>
 {% endfor %}
  </select>
</div>
                         <a href="#openmap" data-toggle="modal" data-target="#location">Map</a>
<div class="row">
                            
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="appbundle_restaurants_restaurantLat">Latitude</label>
                                        <div id="appbundle_restaurants_restaurantLat_form_group" class="form-group "><input type="text" id="appbundle_restaurants_restaurantLat" name="latitude" maxlength="255" class="form-control"></div>
                                    </div>
                                </div>   
                                     <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="appbundle_restaurants_restaurantLong">Longitude</label>
                                        <div id="appbundle_restaurants_restaurantLong_form_group" class="form-group "><input type="text" id="appbundle_restaurants_restaurantLong" name="longitude" maxlength="255" class="form-control form-control"></div>
                                    </div>
                                </div>
                            </div>
          
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        </form>
      </div>
      
    </div>
  </div>
  




<div class="row">
    <div class="col-md-12">
        <div class="card">
            {# {{ path('category_create') }} #}
            <div class="card-body">
                   <h4 class="card-title">Manage Pickup Location<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" style="float:right;">
                Create New</button></h4>
  

                <table class="table table-hovered" id="myTable">
                    <thead>
                    <tr>
                      <th>#</th>
                        <th>Location</th>
                        <th>Address</th>
                        <th>Contact Details</th>
                        <th>Delivery Block</th>
                        <th>Action</th>
                    </tr>
                    
                </thead>
                {% set count = 1 %}
                    {% for loc in location %}
<tr>
<td>{{ count }} </td>
<td>{{ loc.name }} </td>
<td>{{ loc.address }} </td>
<td>{{ loc.contact }} </td>
<td> 
  {% for area in areas %}
{% if area.id == loc.parent %}
{{ area.title }}
{% endif %}
{% endfor %} </td>
<td style="text-align:center;"><a href="{{ path('delete_pickup',{'id':loc.id}) }}"   class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></a >

<a href="#edit"   class="btn btn-primary btn-sm" data-toggle="modal" data-target="#edit{{ count }}"><i class="fa fa-edit"></i></a >  <br>
<a href="{{ path('pickup_slots',{'id':loc.id}) }}"   class="btn btn-primary btn-sm" style="margin-top:10px;"><i class="fa fa-edit"></i> Create Slots</a >  </td>

</tr>
<div class="modal fade" id="edit{{ count }}" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Edit Pickup Location</h4>
        </div>
        <div class="modal-body">
          <form method="post" action="{{ path('edit_pickup_location') }}">

<div class="form-group">
  <label>Pickup Location Name</label>
  <input type="text" class="form-control" placeholder="Pickup Location Name" name="name" value="{{ loc.name }}">
  <input type="hidden" class="form-control" placeholder="Pickup Location Name" name="id" value="{{ loc.id }}">
</div>
<div class="form-group">
  <label>Address</label>
  <textarea class="form-control" rows="3" placeholder="Address" name="address">{{ loc.address }}</textarea>
</div>
<div class="form-group">
  <label>Contact Number</label>
  <input type="text" class="form-control" placeholder="Contact Number" name="contact" value="{{ loc.contact }}">
</div>
<div class="form-group">
  <label>Delivery Block</label>
  <select class="form-control" name="area">
 {% for area in areas %}
 <option value="{{ area.id }}" {% if area.id == loc.parent%} selected {% endif %}>{{ area.title }}</option>
 {% endfor %}
  </select>
</div>
<div class="row">
                            
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="appbundle_restaurants_restaurantLat">Latitude</label>
                                        <div id="appbundle_restaurants_restaurantLat_form_group" class="form-group "><input type="text" id="" name="latitude" maxlength="255" class="form-control appbundle_restaurants_restaurantLat" value="{{ loc.latitude }}"></div>
                                    </div>
                                </div>   
                                     <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="appbundle_restaurants_restaurantLong">Longitude</label>
                                        <div id="appbundle_restaurants_restaurantLong_form_group" class="form-group "><input type="text" id="" name="longitude" maxlength="255" class="form-control form-control appbundle_restaurants_restaurantLong" value="{{ loc.longitude }}"></div>
                                    </div>
                                </div>
                            </div>
          
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
        </form>
      </div>
      
    </div>
  </div>
  

{% set count = count +1 %}
                    {% endfor %}  
                                    <tbody>

                      </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!--Nestable js -->
<script src="/assets/plugins/nestable/jquery.nestable.js"></script>
<script src="/assets/plugins/datatables/jquery.dataTables.min.js"></script>
<script>
   $(document).ready(function() {
      $('#myTable').DataTable();
    });
</script>
<script type="text/javascript">
    $(document).ready(function() {
        // Nestable

        //updateOutput($('#nestable').data('output', $('#nestable-output')));
/*
        $('#nestable-menu').on('click', function(e) {
            var target = $(e.target),
                action = target.data('action');
            if (action === 'expand-all') {
                $('.dd').nestable('expandAll');
            }
            if (action === 'collapse-all') {
                $('.dd').nestable('collapseAll');
            }
        });*/

        $('#nestable-menu').nestable();/*
        $('.dd').nestable('collapseAll');*/
    });
    </script>
<!-- Modal -->
<div id="location" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Select Branch Location</h4>
      </div>
      <div class="modal-body">
                         <div  class="map-area">
<script>
var map;
var marker;

function initialize() {
  var mapOptions = {
    zoom: 12
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

  // Get GEOLOCATION
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
        position.coords.longitude);
$('#appbundle_restaurants_restaurantLat').val(position.coords.latitude);
$('#appbundle_restaurants_restaurantLong').val(position.coords.longitude);



      map.setCenter(pos);
      marker = new google.maps.Marker({
        position: pos,
        map: map,
        draggable: true
      });
      google.maps.event.addListener(marker, 'dragstart', function(evt) {
 $('#appbundle_restaurants_restaurantLat').val(marker.position.lat());
$('#appbundle_restaurants_restaurantLong').val(marker.position.lng());

});

    }, function() {
      handleNoGeolocation(true);
    });

  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }

  function handleNoGeolocation(errorFlag) {
    if (errorFlag) {
      var content = 'Error: The Geolocation service failed.';
    } else {
      var content = 'Error: Your browser doesn\'t support geolocation.';
    }

    var options = {
      map: map,
      position: new google.maps.LatLng(60, 105),
      content: content
    };

    map.setCenter(options.position);
    marker = new google.maps.Marker({
      position: options.position,
      map: map,
      draggable: true
    });

  }

  // get places auto-complete when user type in location-text-box
  var input = /** @type {HTMLInputElement} */
    (
      document.getElementById('location-text-box'));


  var autocomplete = new google.maps.places.Autocomplete(input);
  autocomplete.bindTo('bounds', map);

  var infowindow = new google.maps.InfoWindow();
  marker = new google.maps.Marker({
    map: map,
    anchorPoint: new google.maps.Point(0, -29),
    draggable: true
  });

  google.maps.event.addListener(autocomplete, 'place_changed', function() {
    infowindow.close();
    marker.setVisible(false);
    var place = autocomplete.getPlace();
    if (!place.geometry) {
      return;
    }

    // If the place has a geometry, then present it on a map.
    if (place.geometry.viewport) {
      map.fitBounds(place.geometry.viewport);
    } else {
      map.setCenter(place.geometry.location);
      map.setZoom(17); // Why 17? Because it looks good.
    }
    marker.setIcon( /** @type {google.maps.Icon} */ ({
      url: place.icon,
      size: new google.maps.Size(71, 71),
      origin: new google.maps.Point(0, 0),
      anchor: new google.maps.Point(17, 34),
      scaledSize: new google.maps.Size(35, 35)
    }));
    $('#appbundle_restaurants_restaurantLat').val(marker.position.lat());
$('#appbundle_restaurants_restaurantLong').val(marker.position.lng());
    marker.setPosition(place.geometry.location);
    marker.setVisible(true);

    var address = '';
    if (place.address_components) {
      address = [
        (place.address_components[0] && place.address_components[0].short_name || ''), (place.address_components[1] && place.address_components[1].short_name || ''), (place.address_components[2] && place.address_components[2].short_name || '')
      ].join(' ');
    }

  });



}

google.maps.event.addDomListener(window, 'load', initialize);

</script>
<style type="text/css">
  #map-canvas {
  height: 350px;
  width: 100%;
  margin: 0px;
  padding: 0px
}
.pac-container {
    z-index: 1051 !important;
}
</style>
<div style="height:100%; width:100%;">
  <div id="map-canvas"></div>
    <input type="text" id="location-text-box"  class="form-control" placeholder="please enter location" /><br>
</div>
</div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Save & Close</button>
      </div>
    </div>

  </div>
</div>
{% endblock %}