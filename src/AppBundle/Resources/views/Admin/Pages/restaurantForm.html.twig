{% extends "@AppBundle/Admin/base.html.twig" %}

{% block styles %}

 <script src="https://apis.google.com/js/platform.js" async defer></script>
       <script type="text/javascript"
            src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyBSR3pigsWMH7goi_CthGQFckfb5QPOH8E&v=3.21.5a&libraries=drawing&signed_in=true&libraries=places,drawing,geometry"></script>
<link href="/assets/plugins/bootstrap-switch/bootstrap-switch.min.css" rel="stylesheet">
<link href="/assets/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet">
<link href="/assets/plugins/bootstrap-switch/bootstrap-switch.min.css" rel="stylesheet">

<style>
    [type=checkbox]:checked, [type=checkbox]:not(:checked){
        position: relative;
        left: auto;
        opacity: 1;
    }
</style>
{% endblock %}
{% block body %}
 <!-- ============================================================== -->
<!-- Start Page Content -->
<!-- ============================================================== -->
<!-- Row -->
<div class="row">
        <div class="col-lg-12">
            <div class="card card-outline-info">
                <div class="card-header">
                    <h4 class="m-b-0 text-white">Branch Update Panel</h4>
                </div>
                <div class="card-body">
                    {{ form_start(form) }}
                    {% form_theme form '@AppBundle/Themes/widget.html.twig' %}
                        <div class="form-body">
                            <h3 class="card-title">Branch Info</h3>
                            <hr>
                            <div class="row p-t-10">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        {{ form_label(form.restaurantName, "Branch Name") }}
                                        {{ form_row(form.restaurantName,{'attr':{'class':'form-control','placeholder':'Branch Name'}}) }}
                                    </div>
                                </div>
                            </div>
                            <!--/row-->
                           
                             <!--/row-->
                            <div class="row p-t-10">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        {{ form_label(form.gst, "GST Number") }}
                                        {{ form_row(form.gst,{'attr':{'class':'form-control','placeholder':'Shop gst Number'}}) }}
                                    </div>
                                </div>
                            </div>
                            <!--/row-->
                            <!--/row-->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.primaryMobile, "Primary Mobile Number") }}
                                        {{ form_row(form.primaryMobile,{'attr':{'class':'form-control','placeholder':'9918625689'}}) }} 
                                    </div>
                                </div>
                                <!--/span-->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.secondaryMobile, "Secondary Mobile Number") }}
                                        {{ form_row(form.secondaryMobile,{'attr':{'class':'form-control','placeholder':'(optional)'}}) }}
                                    </div>
                                </div>
                                <!--/span-->
                            </div>
                            <!--/row-->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.primaryEmail, "Primary email") }}
                                        {{ form_row(form.primaryEmail,{'attr':{'class':'form-control','placeholder':'test@domain.com'}}) }}
                                    </div>
                                </div>
                                <!--/span-->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.secondaryEmail, "Secondary email") }}
                                        {{ form_row(form.secondaryEmail,{'attr':{'class':'form-control','placeholder':'(optional)'}}) }}
                                    </div>
                                </div>
                                <!--/span-->
                            </div>
                            <!--/row-->

                          <!--/row-->
                              
                              <div class="row">
                                  <div class="col-md-3">
                                      <div class="form-group">
                                          {{ form_label(form.countryCode, "Country Code") }}
                                          {{ form_row(form.countryCode,{'attr':{'class':'form-control'}}) }}
                                      </div>
                                  </div>
                                  <div class="col-md-3">
                                      <div class="form-group">
                                          {{ form_label(form.currencyFormat, "Currency Format") }}
                                          {{ form_row(form.currencyFormat,{'attr':{'class':'form-control'}}) }}
                                      </div>
                                  </div>   
                                    <div class="col-md-3">
                                      <div class="form-group">
                                          {{ form_label(form.allowOutOfStock, "Allow Out Of Stock Products (enable/disable)") }}
                                          {{ form_row(form.allowOutOfStock,{'attr':{'class':'form-control c',"data-on-text":"Active","data-off-text":"Inactive"}}) }}
                                      </div>
                                  </div>
                                {% if app.user.userType == 'root' %}
                                    <div class="col-md-3">
                                      <div class="form-group">
                                {% else %}
                                    <div class="col-md-3" style="display:none">
                                      <div class="form-group">
                                {% endif %}
                                          {{ form_label(form.currencyFormat, "Commission Fee in %") }}
                                          {{ form_row(form.serviceFee,{'attr':{'class':'form-control'}}) }}
                                      </div>
                                  </div>  
                                
                              </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        {{ form_label(form.restaurantAddress, "Shop Address") }}
                                        {{ form_row(form.restaurantAddress,{'attr':{'class':'form-control','placeholder':'(optional)'}}) }}
                                    </div>
                                </div>
                            </div>
                              <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        {{ form_label(form.restaurantLocation, "Shop Location") }}
                                        {{ form_row(form.restaurantLocation,{'attr':{'class':'form-control','placeholder':'(location)'}}) }}
                                    </div>
                                </div>
                            </div>
                           
                         
                            <div class="row">
                              
                                     <div class="col-md-4">
                                    <div class="form-group">
                                        {{ form_label(form.slot, "Next Available Slot") }}
                                        {{ form_row(form.slot,{'attr':{'class':'form-control form-control','placeholder':'1 hour'}}) }}
                                    </div>
                                </div>
                                    <div class="col-md-4">
                                    <div class="form-group">
                                          {{ form_label(form.minimumOrderAmount, "Minimum Order Amount (Default 0)") }}
                                    {{ form_row(form.minimumOrderAmount,{'attr':{'class':'form-control'}}) }}
                                    </div>
                                </div>
              
                                        
                            </div>
                         
                         <a href="#openmap" data-toggle="modal" data-target="#myModal">Map</a>
                           <div class="row">
                            
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.restaurantLat, "Latitude") }}
                                        {{ form_row(form.restaurantLat,{'attr':{'class':'form-control'}}) }}
                                    </div>
                                </div>   
                                     <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form_label(form.restaurantLong, "Longitude") }}
                                        {{ form_row(form.restaurantLong,{'attr':{'class':'form-control form-control'}}) }}
                                    </div>
                                </div>
                            </div>

                            <h3 class="box-title m-t-40">Shop Identity</h3>
                            
                            {% form_theme form '@AppBundle/Themes/file.html.twig' %}
                            <hr>
                            <div class="row">
                                <div class="col-md-3 ">
                                    <div class="form-group">
                                        {{ form_label(form.iconFile, "Shop Photo") }}
                                        {% set iconImage = "" %}
                                        {% if restaurant.iconImage != null %}
                                            {% set iconImage = '/uploads/restaurant/icons/'~restaurant.iconImage %}
                                        {% endif %}
                                        {{ form_row(form.iconFile,{'attr':{'data-default-file':iconImage}}) }}
                                    </div>
                                </div>
                              
                              
                            </div>
                            <!--/row-->

                            
                            {% form_theme form '@AppBundle/Themes/widget.html.twig' %}
                      
                         
                           
                            <!--/row-->
                            
                    
                           
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success"> <i class="fa fa-check"></i> Save</button>
                            <button type="reset" class="btn btn-inverse">Cancel</button>
                        </div>
                    {{ form_end(form) }}
                    {{ form_rest(form) }}
                </div>
            </div>
        </div>
    </div>
    <!-- Row -->



    <!-- ============================================================== -->
    <!-- End PAge Content -->
    <!-- ============================================================== -->

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Select Branch Location</h4>
      </div>
      <div class="modal-body">
                         <div  class="map-area">
<script>
var map;
var marker;

function initialize() {
  var mapOptions = {
    zoom: 12
  };
  map = new google.maps.Map(document.getElementById('map-canvas'),
    mapOptions);

  // Get GEOLOCATION
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
        position.coords.longitude);
      if($('#appbundle_restaurants_restaurantLat').val()=='')
      {
  $('#appbundle_restaurants_restaurantLat').val(position.coords.latitude);
$('#appbundle_restaurants_restaurantLong').val(position.coords.longitude);      
      }




      map.setCenter(pos);
      marker = new google.maps.Marker({
        position: pos,
        map: map,
        draggable: true
      });
      google.maps.event.addListener(marker, 'dragstart', function(evt) {
//  $('#appbundle_restaurants_restaurantLat').val(marker.position.lat());
// $('#appbundle_restaurants_restaurantLong').val(marker.position.lng());

});

    }, function() {
      handleNoGeolocation(true);
    });

  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }

  function handleNoGeolocation(errorFlag) {
    if (errorFlag) {
      var content = 'Error: The Geolocation service failed.';
    } else {
      var content = 'Error: Your browser doesn\'t support geolocation.';
    }

    var options = {
      map: map,
      position: new google.maps.LatLng(60, 105),
      content: content
    };

    map.setCenter(options.position);
    marker = new google.maps.Marker({
      position: options.position,
      map: map,
      draggable: true
    });

  }

  // get places auto-complete when user type in location-text-box
  var input = /** @type {HTMLInputElement} */
    (
      document.getElementById('location-text-box'));


  var autocomplete = new google.maps.places.Autocomplete(input);
  autocomplete.bindTo('bounds', map);

  var infowindow = new google.maps.InfoWindow();
  marker = new google.maps.Marker({
    map: map,
    anchorPoint: new google.maps.Point(0, -29),
    draggable: true
  });

  google.maps.event.addListener(autocomplete, 'place_changed', function() {
    infowindow.close();
    marker.setVisible(false);
    var place = autocomplete.getPlace();
    if (!place.geometry) {
      return;
    }

    // If the place has a geometry, then present it on a map.
    if (place.geometry.viewport) {
      map.fitBounds(place.geometry.viewport);
    } else {
      map.setCenter(place.geometry.location);
      map.setZoom(17); // Why 17? Because it looks good.
    }
    marker.setIcon( /** @type {google.maps.Icon} */ ({
      url: place.icon,
      size: new google.maps.Size(71, 71),
      origin: new google.maps.Point(0, 0),
      anchor: new google.maps.Point(17, 34),
      scaledSize: new google.maps.Size(35, 35)
    }));
    $('#appbundle_restaurants_restaurantLat').val(marker.position.lat());
$('#appbundle_restaurants_restaurantLong').val(marker.position.lng());
    marker.setPosition(place.geometry.location);
    marker.setVisible(true);

    var address = '';
    if (place.address_components) {
      address = [
        (place.address_components[0] && place.address_components[0].short_name || ''), (place.address_components[1] && place.address_components[1].short_name || ''), (place.address_components[2] && place.address_components[2].short_name || '')
      ].join(' ');
    }

  });



}

google.maps.event.addDomListener(window, 'load', initialize);

</script>
<style type="text/css">
  #map-canvas {
  height: 350px;
  width: 100%;
  margin: 0px;
  padding: 0px
}
.pac-container {
    z-index: 1051 !important;
}
</style>
<div style="height:100%; width:100%;">
  <div id="map-canvas"></div>
    <input type="text" id="location-text-box"  class="form-control" placeholder="please enter location" /><br>
</div>
</div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Save & Close</button>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/assets/plugins/bootstrap-switch/bootstrap-switch.min.js"></script>
<script src="/assets/plugins/moment/moment.js"></script>
<script src="/assets/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
<script src="/assets/js/colorpicker.js"></script>

<script>
 
        $(document).ready(function() {



            $('#appbundle_restaurants_orderType').multiselect({
                    nonSelectedText: 'Click Here',
                    enableFiltering: true,
                    enableCaseInsensitiveFiltering: true,
                    buttonWidth:'100%',
                    includeSelectAllOption: true,
                    selectAllValue: 'select-all-value'
                });

            $('#appbundle_restaurants_restaurantType').multiselect({
                    nonSelectedText: 'Click Here',
                    enableFiltering: true,
                    enableCaseInsensitiveFiltering: true,
                    buttonWidth:'100%',
                    includeSelectAllOption: true,
                    selectAllValue: 'select-all-value'
                });

            $('#appbundle_restaurants_openTime').bootstrapMaterialDatePicker({ format : 'HH:mm', time: true, date: false });
            $('#appbundle_restaurants_closeTime').bootstrapMaterialDatePicker({ format : 'HH:mm', time: true, date: false });


            $("#appbundle_restaurants_isOpen").bootstrapSwitch();
            // Basic
            $('.dropify').dropify();
            // Translated
            $('.dropify-fr').dropify({
                messages: {
                    default: 'Glissez-déposez un fichier ici ou cliquez',
                    replace: 'Glissez-déposez un fichier ou cliquez pour remplacer',
                    remove: 'Supprimer',
                    error: 'Désolé, le fichier trop volumineux'
                }
            });
    
            // Used events
            var drEvent = $('#input-file-events').dropify();
    
            drEvent.on('dropify.beforeClear', function(event, element) {
                return confirm("Do you really want to delete \"" + element.file.name + "\" ?");
            });
    
            drEvent.on('dropify.afterClear', function(event, element) {
                alert('File deleted');
            });
    
            drEvent.on('dropify.errors', function(event, element) {
                console.log('Has Errors');
            });
    
            var drDestroy = $('#input-file-to-destroy').dropify();
            drDestroy = drDestroy.data('dropify')
            $('#toggleDropify').on('click', function(e) {
                e.preventDefault();
                if (drDestroy.isDropified()) {
                    drDestroy.destroy();
                } else {
                    drDestroy.init();
                }
            })
        });

</script>

{% endblock %}